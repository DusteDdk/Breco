flowchart TD
startScan["ScanController::startScan"] --> validateStart["Validate running/term/targets"]
validateStart --> spawnWorkers["Create and start ScanWorker pool"]
spawnWorkers --> startReader["Launch readerLoop thread"]
startReader --> blockRead["Read shifted block + overlap"]
blockRead --> partitionJobs["Partition block into jobs"]
partitionJobs --> dispatchOrQueue["Dispatch idle worker or queue job"]
dispatchOrQueue --> workerExec["Worker executes MatchUtils search"]
workerExec --> markComplete["markJobTokenCompleted"]
markComplete --> readerWait["Reader waits pending buffers == 0"]
readerWait --> stopWorkers["Request stop + wake workers"]
stopWorkers --> tickFinalize["onTick joins threads"]
tickFinalize --> mergeResults["buildFinalResults"]
mergeResults --> buildBuffers["buildResultBuffers"]
buildBuffers --> emitBatch["emit resultsBatchReady"]
emitBatch --> emitFinished["emit scanFinished"]
